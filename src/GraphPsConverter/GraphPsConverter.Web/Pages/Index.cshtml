@page
@model IndexModel
@{
    ViewData["Title"] = "Graph PowerShell";
}

<div>
    <h1 class="display-4">Graph PowerShell Conversion Analyzer</h1>
    <p>Get help converting your MSOnline and Azure AD PowerShell script to Graph PowerShell.</p>
    <p>Paste in your MSOnline and Azure AD PowerShell scripts and click Analyze.</p>

    <form method="post" id="convertForm">

        <div id="monSourceScript" style="width:800px;height:300px;border:1px solid grey"></div>

        <textarea id="sourceScriptText" asp-for="SourceScript" class="form-control" style="display:none;"></textarea>
        <p>
            <input type="submit" value="Analyze" asp-page-handler="Submit" />
        </p>


        @{
            if (HttpMethods.IsPost(Request.Method))
            {
                if (Model.ParsedScript != null && Model.ParsedScript.IsValid)
                {
                    <h2>Graph PowerShell Analysis</h2>
                    
                    @foreach (var cmd in Model.ParsedScript.ConvertedCommands)
                    {
                        <h3>@cmd.AadCmdName</h3>
                        <p>
                        <a href="@cmd.AadCmdDocLink" target="_blank">@cmd.AadCmdName</a> @Html.Raw("=>") <a href="@cmd.GraphCmdDocLink" target="_blank">@cmd.GraphCmdDisplayName</a>
                        </p>
                        <p>
                        <code>@cmd.ConvertedScript</code>
                        </p>
                    }
                }
                else
                {
                    <p>There were some errors converting.</p>
                    if (Model.ParsedScript != null && Model.ParsedScript.Errors.Count > 0)
                    {
                        <ul>
                        @foreach (var err in Model.ParsedScript.Errors)
                        {
                            <li>@err.ErrorCode - @err.Message</li>
                        }
                        </ul>
                    }
                }
            }
        }

    </form>
</div>
@section scripts{
<script>
    var editor;
    $(document).ready(function () {
        require.config({ paths: { 'vs': '/lib/vs' } });
        editor = monaco.editor.create(document.getElementById('monSourceScript'), {
            value: "",
            language: 'powershell'
        });
    })

    $("#convertForm").submit(function(event) {
        $('#sourceScriptText').val(editor.getValue());
    });
</script>
}